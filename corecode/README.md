# Source code guideline

Download the dataset from "". Uncompress the "simu_data.tar.gz". There are 3 simulation data directory in the Archive.They are "MoreComplexSituation","SimulationOnTwoMotif","ICSimulation".

put the data directory at the "./Data" to set up simulation dataset.

Download the parameters of the models form "". Uncompress the "model_parameter.tar.gz ". There are 3 Simulation parameters in the Archive.
you need to put the model_parameter directory at the "./OutPutAnalyse/result" to set up parameters of Models.

Download and preprocessing Deepbind's data set. Run "python wgetall.py" under "./Data/ChIPSeqData/motif_discovery" dir. It will download all the dataset automatically. The result will be saved in "./Data/ChIPSeqData/motif_discovery". Then Run "python seq_to_matrix.py" under "./DataGeneRate/ChIPSeqData" dir, it will convert the original dataset into one-hot representation which can be used for further training. The result will be saved in "./Data/ChIPSeqData/HDF5" . This path need to pass through command line when training the model.

REMARK: Code needs to run on python 2


# Directory organization

All the paths in code directory is relative path. And by default, the root path is "./".

Simulation data is under: root + "Data/". There are three main simulation data sets: "ICSimulation", "SimulationOnTwoMotif", "MoreComplexSituation" under this directory. And there 3 datasets in ICSimulation, 4 datasets in SimulationOnTwoMotif, and 5 datasets in MoreComplexSituation. More details are in the paper.

Motifs in simulation dataset are saved in: root + "OutPutAnalyse/ModelAUC" and the seqLogo in under: root + "motifRestore/".
We provide Shannoy Entropy analysis for "SimulationOnTwoMotif" and are saved in "ShannoyPic/SimulationOnTwoMotif", you can use
``` python ./corecode/ShannoyEntropy.py```
to analysise it

All results are saved under: result_root = root + "OutPutAnalyse/". Under this directory, including following directories:

| Directory path | explanation |
| ------------- |:-------------:|
| result_root + "code/"|  There are different code scripts for generate the AUC boxplot named with "check*.py". And the motif rebuild code are in the scripy named with "MotifRebuild*.py"|
| result_root + "result/" | All the model for every dataset and grid-search for hyper-parameters|
| result_root + "ModelAUC/" | The AUC boxplots for each different datatype and different datasets which are generated by the scripts "check*.py" |
| result_root + "motifRestore/" | all motifs rebuilt used with the model in result_root+"/result". And the directory will be named the same as the name in the result_root+"/result"|

| result_root + "ShannoyPic/" | Shannoy Entropy during the training process for dataset "SimulationOnTwoMotif"|


## (1) Theoretical scoring

Code for this section is in sorted_explain.py file. Using "ipython sorted_explain.py [parameter]" to regenerate the result.

Set [parameter] as "run_preal_plot"  to generate the theoretical score. 

Set [parameter] as " draw_detail_CNN_kerLen" to draw average AUCs for different kernel lengths and data sets.

Set [parameter] as  "visu_detail_AvePreal" to further visualize the p_real. 

### requirement:

(a) Having "simuMtf_Len-8_totIC-10.txt", "simuMtf_Len-23_totIC-12.txt" saving motif's PWM

(b) Having simulation results saved in: result_root + "result/ICSimulation/" .  Also, the result have to be organized as the one mentioned in the table above.


# (2)Test on simulation data set
  There are 3 different simulation datasets, 
## (a)Training:

Go to "./TrainCode/MoreComplexSituation" directory and run: "python trainVCNN.py" to train the vCNN model for "MoreComplexSituation" datasets and "python trainCNN.py" to train the CNN model. The result will be saved in: result_root + "MoreComplexSituation/".
Go to "./TrainCode/SimulationOnTwoMotif" directory and run: "python trainVCNN.py" to train the vCNN model for "SimulationOnTwoMotif" datasets and "python trainCNN.py" to train the CNN model. The result will be saved in: result_root + "SimulationOnTwoMotif/".
Go to "./TrainCode/ICSimulation" directory and run: "python trainVCNN.py" to train the vCNN model for "ICSimulation" datasets and "python trainCNN.py" to train the CNN model. The result will be saved in: result_root + "ICSimulation/".
Remark: train.py will force to Using python interpreter in PATH. And it will use "KERAS_BACKEND" by default. Run all the simulation results may take about 2 days. All the trained result and model parameters can be downloaded from "". One can choose to download and unzip under /result dir and continue the following tests.

## (b)Draw AUC box-plot


Go to result_root + "code/" directory and run: "python checkComplexSimu.py". The result for "MoreComplexSituation" will be saved in: result_root + "/ModelAUC/MoreComplexSituation/"
Go to result_root + "code/" directory and run: "python checkTwoMotifSimu.py". The result for "SimulationOnTwoMotif" will be saved in: result_root + "/ModelAUC/SimulationOnTwoMotif/"
Go to result_root + "code/" directory and run: "python checkIC.py". The result for "ICSimulation" will be saved in: result_root + "/ModelAUC/ICSimulation/"

## (c)Recover kernel to PWM

Go to result_root + "code/" directory and run: "ipython MotifRebuildComplexSimu.py". The result will be saved in: result_root + "MotifRebuild/MoreComplexSituation"
Go to result_root + "code/" directory and run: "ipython MotifRebuildTwoMotifSimu.py". The result will be saved in: result_root + "MotifRebuild/SimulationOnTwoMotif"
Go to result_root + "code/" directory and run: "ipython MotifRebuildIC.py". The result will be saved in: result_root + "MotifRebuild/ICSimulation"

## (d)Compare the similarity between kernel and motif

Go to result_root + "code/" directory and run: "ipython MotifScoreComplexSimu.py". The result will be saved in: result_root + "MotifRebuild/MoreComplexSituation"
Go to result_root + "code/" directory and run: "ipython MotifScoreTwoMotifSimu.py". The result will be saved in: result_root + "MotifRebuild/SimulationOnTwoMotif"
Go to result_root + "code/" directory and run: "ipython MotifScoreIC.py". The result will be saved in: result_root + "MotifRebuild/ICSimulation"



# (2)Compare with Deepbind's result and another [CNN](https://academic.oup.com/bioinformatics/article/32/12/i121/2240609)

## (a)Requirement

Deepbind's result has been downloaded and saved as "./OutPutAnalyse/ModelAUC/ChIPSeq/deepbind_pred/" .

## (b)Run model on Deepbind's dataset
Go to "./TrainCode/DeepBindChIpSeqCode" directory and run: "python trainAll.py" to train the vCNN model for "ChIpSeq" datasets The result will be saved in: result_root + "ChIPSeq/".

Remark: I divided the datasets into 7 parts to improve the speed for training process. You can also choose to run the aother 7 scripts to get the same results as the first way. But Run all the results may take days. One can also continue the following process by downloading the trained parameters from "". Unzip under /result dir and continue the following tests to compare the results.

## Analyse the result 
Go to result_root + "code/" directory and run: "python checkResultComparedDeepBind.py". The result for "ChIPSeq" will be saved in: result_root + "/ModelAUC/ChIPSeq/"
you would get the AUC comparison between vCNN and DeepBind model
